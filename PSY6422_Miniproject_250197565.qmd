---
title: "PSY6422_Miniproject_250197565"
format: html
editor: visual
---

## Introduction

### Data Origins

The data set used for this mini-project was from a data paper titled [*'Data on Connection With the Natural Environment and Its Impact on Mental Health Among Allotment and Non-Allotment Owners'*](https://openpsychologydata.metajnl.com/articles/10.5334/jopd.122), by L. Haywood and J. Stiller(2024). The paper can be found on the [Journal of Open Psychology Data](https://openpsychologydata.metajnl.com/) website and the data set is available to download there.

The data was collected using an online survey from allotment and non-allotment owners with the aim of observing the relationship between well-being and engagement with activities in nature.

The questionnaire had items about demographics(age, gender, nationality), and questions regarding ownership and engagement in allotment activities, including time spent in nature and the types of outdoor activities. Along with that, mental health, self-esteem, physical health, connection to nature, social identity, loneliness, social support and self-efficacy were measured. A comprehensive guide of the items and scales used in the questionnaire can be found in the data paper on the Journal of Open Psychology Data website.

(Explain why these variables were chosen in brief)

The full, detailed codebook can be downloaded from the data paper under the 'Additional Files' section. Alternatively, it can be accessed by the [repository link](https://data.mendeley.com/datasets/8y2h89z46s/3) mentioned in the same paper.

### Research Question

Using the data set from the above paper, this mini-project will attempt to visualize the relationship between mental health, time spent in nature, and connection to nature, and any potential differences in men and women. and attempt to answer the question â€” 'Does time spent in nature improve mental health?'

### Data Preparation

The published data set has already been cleared of errors, outliers and required items have been reverse coded. The variables and column names are also compatible and easy to work with in R.

Data preparation will start with importing the data.

```{r}
#Install tidyverse in console for data wrangling
#Code--> install.packages("tidyverse")
library(tidyverse)

#Import dataset and create an object for easy management
#Use correct pathway as required 
#Only used csv file name here since it is already in the project folder
rawdata <- read_csv("connection_to_nature_data.csv")


```

Check the first few rows of the raw data set to make sure that the column names and values look good (this is not an issue in this data set since the authors have already cleaned the data for the most part). After that, check for any missing data.

```{r}
#To check the dataframe,including number of rows and columns
glimpse(rawdata)

#To see the first few rows of the dataframe as tibble use head()
#More readable but only shows the first 6 rows 
head(rawdata)

#To check for any missing data
colSums(is.na(rawdata))
#Another way do this : naniar to visualise the missing data
#Install the naniar package in console and load to visualise missing data
#Code--> install.packages("naniar)
library(naniar)
#Visualise missing data
vis_miss(rawdata)

```

Crosschecking with the dataframe in the environment showed that most of the missing data is the work of empty rows that hold no values across all columns at the bottom. The dataframe does not require any imputations and the rows with missing data can be dropped when creating a revised dataframe.

The next step is to tidy the data and create a new dataframe removing the missing data points and including only the required variables for the visualizations to answer the research question for this mini-project.

This involves creating new columns for the mean values for the Mental Health columns, Connection to Nature columns, and Self-efficacy columns. While the individual scales used in the questionnaire calculate the scores by adding the self-reported scores across the items, this project will be calculating the mean scores instead as the individual scales have different score ranges. Using the mean scores for the scales will ensure uniformity, allowing for a more accurate visualization.

The data in the gender column will also have to be changed to 'male' and 'female' from their coded values. The column named D_hours will be used but does not require any modifications.

```{r}
#Create the revised dataframe as an object
revdata <- rawdata %>% 
   #to ignore any rows with missing values
  drop_na() %>%
  mutate( #create new columns with the mean values from the MH, Nat, SEff columns
    mean_mh = rowMeans(across(.cols = starts_with("MH")), na.rm = TRUE),
    mean_nat = rowMeans(across(.cols = starts_with("Nat")), na.rm = TRUE),
    #change numberical values to factors in the gender column 
    #check the codebook and use the correct values; 1=Man, 2=Women
    Gender = factor(D_Gender, levels = c(1,2), labels = c("Men", "Women")),
    Group = factor(D_group, levels = c(1,2), labels = c("Allotment Owners", "Non-Allotment owners"))
    ) %>% 
  #Select only the required columns for the revised dataframe
  select (c("Gender", "Group", "D_hours", "mean_mh", "mean_nat"))
 


#New dataframe should be visible in environment now
#Check if the changes have been made correctly
head(revdata)

  
```

### Visualizations

The aim is to create a scatter plot measuring the average mental health scores and its relationship with the hours spent in nature per week, along with the average connection to nature scores and the differences between genders.

Start with loading the necessary packages to do this.

```{r}
#install and load ggplot2 package
#Code in console--> install.packages("ggplot2)
#install plotly package for interactive graphs
#Code in console--> install.packages("plotly")
library(ggplot2)
library(plotly)

#Create the scatterplot as an object 
base_scatter <- ggplot(data = revdata,aes(x = mean_mh, y = D_hours, color = mean_nat))+
  geom_point(alpha = 0.9) + #alpha value can be changed to adjust the opaqueness of the points
  geom_smooth(method = "lm", se = TRUE, color = "black", linewidth = 0.6)+
  #method draws a line to show correlation, se stands for standard deviation
  #lm is for a linear model to show a correlation
  labs(x = "Mean Mental Health Score",
       y = "Hours spent in Nature per week",
       color = "Nature Connection",
       title = "Mental Health and Nature Exposure")+
  facet_grid( Gender ~ Group)+ #makes a grid seperated by gender and group
  scale_color_viridis_c(option = "cividis", direction = -1)+
  #colorblind friendly color palette for continuous variables
  #direction can be changed to 1 to flip the direction of the scale 
  theme_light()

#To see the graph
base_scatter

#To make it an interactive graph
ggplotly(base_scatter)

```

In the above scatterplot, the NA row only contains one value, and for this visualization, the rows with NA as gender will be ignored since it does not seem of relevance with the data provided (while the question was open-ended in the questionnaire, the codebook does not show a value the third gender was coded into.

Allotment owners and non-allotment owners seem to follow the same pattern as each other, and the focus on allotment groups will be dropped here on for this visualization.

To make the necessary changes, the previous data code for the revised data frame must be edited, and the code for the scatterplot can be run again.

```{r}
#Use filter to show only "Men" and "Women" in revdata
revdata <- revdata %>% 
  filter(Gender == "Men" | Gender == "Women")
#Can check the change in number of rows to make sure using glimpse(revdata) 

#Running the scatterplot again
base_scatter <- ggplot(data = revdata,aes(x = mean_mh, y = D_hours, color = mean_nat))+
  geom_point()+#removing alpha due to visibility issues with cividis yellow
  geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.6)+
  labs(x = "Mean Mental Health Score",
       y = "Hours spent in Nature per week",
       color = "Nature Connection",
       title = "Mental Health and Nature Exposure")+
  facet_wrap( ~ Gender)+ #since a grid is not required' will only show gender
  scale_color_viridis_c(option = "cividis", direction = -1)+
  theme_light()

base_scatter
ggplotly(base_scatter)

```

The last few steps will be to create a custom, accessible theme for the scatterplot to make it more visually appealing.

```{r}
#Adjusted code for scatterplot without facet_wrap(~Gender)
base_scatter <- ggplot(data = revdata,aes(x = mean_mh, y = D_hours, color = mean_nat))+
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE, color = "black", linewidth = 0.6)+
  labs(x = "Mean Mental Health Score",
       y = "Hours spent in Nature per week",
       color = "Nature Connection",
       title = "Mental Health and Nature Exposure")+
    scale_color_viridis_c(option = "cividis", direction = -1)+
  theme_light()
base_scatter

#Create a custom theme as a function
theme_mod01 <- function(){
  theme_minimal() +
    theme (
  legend.position = "bottom", #adjusts legend orientation
  plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
  axis.title = element_text(size = 14),#formats text for plot and axis titles
  panel.grid.minor = element_blank()#leaves out minor grid lines
  )#adds color for plot background
}

#Add the custom theme to the scatterplot
p_scatter <- base_scatter + theme_mod01()
ggplotly(p_scatter)

```

And as a final touch, gender will be shown in an animated graph.

```{r}
#Add animation to the graph
#Aim : show the two genders one at a time
#Install necessary packages in console
#Code for gganimate--> install.packages("gganimate") 
#Code for gifski--> install.packages("gifski")
library(gganimate)
library(gifski)

#Animation requirements
anim_scatter <- p_scatter + 
  transition_states(Gender,#the categorical variable the transition is done on
                    transition_length = 2,#speed of transition
                    state_length = 10)+#screentime for each category
  labs(title = "Mental Health and Nature Exposure",
       subtitle = "Showing {closest_state}")


#Animate the final scatterplot
final_animscatter <- animate(anim_scatter, renderer = gifski_renderer())

#Save the animated graph as gif
anim_save("miniproject_animated_graph.gif", animation = final_animscatter)

```

### Final Visualization 

Here is the final visualization: an animated scatterplot.

### Summary

-   Brief thoughts on what you have learnt, what you might do next if you had more time / more data
